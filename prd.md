# Flomo MCP Server 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
Flomo MCP Server 是一个基于 Model Context Protocol (MCP) 的智能备忘录管理服务，为 AI 助手提供访问和分析 Flomo 个人知识库的能力。通过智能检索、关联发现和深度分析，帮助用户更好地管理和利用个人思考记录。

### 1.2 目标用户
- **知识工作者**：研究员、分析师、咨询师
- **内容创作者**：写作者、博主、自媒体人
- **学习者**：学生、终身学习者、技能提升者
- **创意工作者**：设计师、产品经理、创业者
- **个人成长者**：自我反思、目标管理、习惯养成

### 1.3 核心价值
- **智能检索**：快速找到相关的历史思考记录
- **关联发现**：发现看似无关想法之间的深层连接
- **知识整理**：将散落的想法组织成结构化知识
- **趋势分析**：了解个人思考模式和兴趣演化
- **创意激发**：通过关联推荐激发新的思考

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 智能检索与搜索
**功能描述**：提供多维度的备忘录检索能力

**具体功能**：
- **关键词搜索**：支持全文检索，包括标题和内容
- **标签筛选**：按单个或多个标签组合筛选
- **时间范围**：按创建时间、更新时间筛选
- **内容类型**：区分纯文本、包含图片、包含链接等
- **高级搜索**：支持 AND/OR/NOT 逻辑组合

**用户场景**：
```
场景1：研究员需要找到3个月前关于"机器学习"的所有记录
输入：search_memos(keywords="机器学习", date_range="3months", limit=50)
输出：按相关性排序的备忘录列表，包含摘要和标签

场景2：写作者搜索包含"创意"和"灵感"标签的内容
输入：search_memos(tags=["创意", "灵感"], logic="AND")
输出：符合条件的备忘录，按时间倒序排列
```

#### 2.1.2 智能推荐与关联
**功能描述**：基于内容相似度和用户行为提供智能推荐

**具体功能**：
- **相关推荐**：基于当前备忘录推荐相关内容
- **主题聚类**：将相似主题的备忘录聚合
- **关联网络**：构建备忘录之间的关联图谱
- **跨时间关联**：发现不同时期相似思考
- **意外发现**：推荐看似无关但可能有价值的内容

**用户场景**：
```
场景1：基于当前阅读的论文发现相关历史思考
输入：get_related_memos(memo_id="xxx", similarity_threshold=0.7)
输出：相关度排序的推荐列表，包含相似度分数

场景2：发现"产品设计"主题下的所有相关想法
输入：discover_topic_cluster(seed_keywords=["产品设计"])
输出：主题聚类结果，包含核心概念和相关备忘录
```

#### 2.1.3 标签智能管理
**功能描述**：提供标签分析和管理优化建议

**具体功能**：
- **标签统计**：分析标签使用频率和分布
- **层级分析**：解析标签的层级结构
- **使用趋势**：追踪标签使用的时间变化
- **标签建议**：推荐标签规范化和合并
- **热点发现**：识别新兴和衰落的关注点

**用户场景**：
```
场景1：了解个人关注领域的分布情况
输入：analyze_tag_hierarchy(include_stats=true)
输出：标签树状结构，包含使用次数和占比

场景2：发现一年来关注点的变化趋势
输入：get_tag_evolution(time_range="1year", top_n=20)
输出：标签使用趋势图表数据，标注重要变化点
```

#### 2.1.4 内容深度分析
**功能描述**：对备忘录内容进行深度分析和洞察提取

**具体功能**：
- **关键词提取**：识别内容中的重要概念
- **情感分析**：分析文本的情感倾向
- **主题建模**：自动发现隐含主题
- **观点提取**：识别关键观点和结论
- **问题识别**：提取文中的问题和疑惑

**用户场景**：
```
场景1：提取一段时间内思考的核心洞察
输入：extract_insights(date_range="last_month", insight_type="key_points")
输出：结构化的洞察列表，按重要性排序

场景2：分析个人思考的情感变化趋势
输入：analyze_sentiment_trends(time_granularity="week")
输出：情感趋势图表，标注异常时期
```

#### 2.1.5 知识图谱构建
**功能描述**：构建个人知识网络，可视化思考结构

**具体功能**：
- **概念网络**：构建概念之间的关联网络
- **时间演化**：追踪想法的发展历程
- **影响路径**：分析想法之间的影响关系
- **知识空白**：识别知识体系中的空白点
- **学习路径**：基于知识图谱推荐学习方向

**用户场景**：
```
场景1：构建"人工智能"领域的个人知识图谱
输入：build_knowledge_graph(domain="人工智能", depth=3)
输出：图谱数据结构，包含节点、边和权重信息

场景2：追踪某个想法的完整演化过程
输入：trace_idea_evolution(concept="产品思维", time_span="2years")
输出：时间轴数据，展示想法的发展轨迹
```

#### 2.1.6 数据导出与整理
**功能描述**：将备忘录数据整理成各种格式，便于后续使用

**具体功能**：
- **Markdown 导出**：生成结构化的 Markdown 文档
- **思维导图**：生成思维导图数据格式
- **时间线视图**：按时间顺序整理内容
- **主题报告**：生成特定主题的综合报告
- **统计报告**：生成使用统计和分析报告

**用户场景**：
```
场景1：将读书笔记整理成结构化文档
输入：export_by_topic(topic="读书笔记", format="markdown", structure="hierarchical")
输出：按书籍和章节组织的 Markdown 文档

场景2：生成年度思考回顾报告
输入：generate_annual_report(year=2024, include_stats=true)
输出：包含统计数据和关键洞察的综合报告
```

### 2.2 辅助功能

#### 2.2.1 数据同步与缓存
- **增量同步**：只获取更新的内容，提高效率
- **智能缓存**：缓存常用数据，减少 API 调用
- **离线支持**：支持离线模式下的基本功能

#### 2.2.2 性能优化
- **分页处理**：大数据量的分页加载
- **并发控制**：合理控制 API 请求频率
- **错误重试**：网络异常时的自动重试机制

#### 2.2.3 用户体验
- **进度反馈**：长时间操作的进度提示
- **结果预览**：提供结果摘要和预览
- **参数建议**：智能推荐合适的参数设置

## 3. 非功能性需求

### 3.1 性能要求
- **响应时间**：常规查询 < 2秒，复杂分析 < 10秒
- **并发支持**：支持多个 AI 助手同时访问
- **数据处理**：支持处理 10,000+ 备忘录
- **内存使用**：合理控制内存占用，避免内存泄漏

### 3.2 可靠性要求
- **错误处理**：优雅处理各种异常情况
- **数据一致性**：确保数据的准确性和完整性
- **故障恢复**：网络中断后的自动恢复
- **日志记录**：完整的操作日志和错误日志

### 3.3 安全性要求
- **认证机制**：安全的 Token 管理和验证
- **数据保护**：用户数据的安全存储和传输
- **访问控制**：合理的权限管理机制
- **隐私保护**：不泄露用户敏感信息

### 3.4 可维护性要求
- **模块化设计**：清晰的模块划分和接口定义
- **代码质量**：遵循编码规范，保持代码可读性
- **文档完整**：完整的 API 文档和使用说明
- **测试覆盖**：充分的单元测试和集成测试

## 4. 用户交互设计

### 4.1 MCP 工具接口设计

#### 4.1.1 搜索相关工具
```json
{
  "name": "search_memos",
  "description": "搜索备忘录",
  "parameters": {
    "keywords": "搜索关键词",
    "tags": "标签列表",
    "date_range": "时间范围",
    "limit": "结果数量限制",
    "sort_by": "排序方式"
  }
}
```

#### 4.1.2 分析相关工具
```json
{
  "name": "analyze_tags",
  "description": "分析标签使用情况",
  "parameters": {
    "analysis_type": "分析类型",
    "time_range": "时间范围",
    "include_hierarchy": "是否包含层级分析"
  }
}
```

#### 4.1.3 推荐相关工具
```json
{
  "name": "get_related_memos",
  "description": "获取相关推荐",
  "parameters": {
    "memo_id": "备忘录ID",
    "similarity_threshold": "相似度阈值",
    "exclude_same_tags": "是否排除相同标签"
  }
}
```

### 4.2 返回数据格式规范

#### 4.2.1 备忘录数据结构
```json
{
  "id": "备忘录ID",
  "content": "内容",
  "summary": "摘要",
  "tags": ["标签列表"],
  "created_at": "创建时间",
  "updated_at": "更新时间",
  "similarity_score": "相似度分数",
  "files": ["附件列表"]
}
```

#### 4.2.2 分析结果数据结构
```json
{
  "analysis_type": "分析类型",
  "time_range": "分析时间范围",
  "total_count": "总数量",
  "insights": ["关键洞察"],
  "trends": ["趋势数据"],
  "recommendations": ["建议列表"]
}
```

## 5. 成功指标

### 5.1 功能指标
- **搜索准确率**：相关结果占比 > 85%
- **推荐满意度**：用户采纳推荐内容的比例 > 60%
- **数据完整性**：成功同步的备忘录比例 > 99%
- **分析准确性**：标签分析和趋势分析的准确性

### 5.2 性能指标
- **响应时间**：95% 的请求在 3 秒内完成
- **系统可用性**：99.5% 的时间系统正常运行
- **错误率**：API 调用错误率 < 1%
- **资源使用**：CPU 和内存使用保持在合理范围

### 5.3 用户体验指标
- **易用性**：AI 助手能够轻松调用各种功能
- **结果质量**：返回结果的相关性和有用性
- **功能覆盖**：满足不同用户场景的需求
- **稳定性**：长期使用过程中的稳定表现

## 6. 风险与限制

### 6.1 技术风险
- **API 限制**：Flomo API 的调用频率和数据量限制
- **数据同步**：大量数据同步的性能和稳定性问题
- **内容解析**：HTML 内容解析的准确性和兼容性

### 6.2 业务风险
- **API 变更**：Flomo API 接口变更的影响
- **用户隐私**：用户数据处理的隐私保护要求
- **依赖性**：对 Flomo 服务的强依赖性

### 6.3 缓解措施
- **错误处理**：完善的异常处理和降级机制
- **数据备份**：重要数据的本地缓存和备份
- **版本兼容**：保持对不同 API 版本的兼容性
- **用户控制**：给用户充分的数据控制权

## 7. 后续规划

### 7.1 短期目标 (1-2 个月)
- 完成核心搜索和推荐功能
- 实现基础的标签分析
- 提供稳定的 MCP 接口

### 7.2 中期目标 (3-6 个月)
- 增加智能分析功能
- 完善知识图谱构建
- 优化性能和用户体验

### 7.3 长期目标 (6-12 个月)
- 集成更多 AI 能力
- 支持多平台数据源
- 构建完整的个人知识管理生态 